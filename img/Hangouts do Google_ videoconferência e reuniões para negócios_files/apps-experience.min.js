var timeoutID=0,activeApp="";var AppsExperience=function(){};
AppsExperience.prototype={EXPERIENCE_HOST_LOCATION:"/experience/",EXPERIENCE_JS_LOCATION:"/experience/",LIBRARY_SCRIPTS:["//www.gstatic.com/external_hosted/createjs/easeljs-0.6.1.min.js","//www.gstatic.com/external_hosted/createjs/tweenjs-0.4.1.min.js","//www.gstatic.com/external_hosted/createjs/movieclip-0.6.0.min.js","//www.gstatic.com/external_hosted/createjs/preloadjs-0.3.1.min.js"],JQUERY_FALLBACK:"raw",overlayName:"apps_overlay",init:function(params){var me=this;appsExperience=me;me.params=
params;me.locale=me.params.locale||"en_us";me.type=me.params.type||"raw";me.detectDevice();me.checkAnaltyics();return me},detectDevice:function(){var me=this,agent=navigator.userAgent.toLowerCase(),isMobile=false;if(typeof deviceConfig!=="undefined")return;if(agent.match(/android|blackberry|iphone|ipad|ipod|opera mini|iemobile/i))isMobile=true;deviceConfig={mobile:isMobile}},checkAnaltyics:function(){var me=this,scriptTag=document.createElement("script"),head=document.getElementsByTagName("head")[0];
if((typeof dataLayer==="undefined"||typeof dataLayer.push!=="function")&&typeof manuallyInstalled==="undefined"){manuallyInstalled=true;scriptTag.src="//www.googletagmanager.com/gtm.js?id=GTM-Q4J6";scriptTag.addEventListener("load",function(){me.addListeners()},false);head.appendChild(scriptTag)}else me.addListeners()},setupOverlay:function(){var me=this,elem=document.getElementById(me.params.target),overlay=document.createElement("div");if(deviceConfig.mobile||me.params.youtubeForce)overlay.className=
"apps_overlay_mobile";else overlay.className="apps_overlay";overlay.id=me.overlayName+"-"+me.params.target;overlay.style.overflow="hidden";overlay.style.top=elem.offsetTop+"px";document.body.appendChild(overlay);me.setPositioning();me.container=document.getElementById(me.overlayName+"-"+me.params.target);if(deviceConfig.mobile||me.params.youtubeForce){document.body.removeChild(overlay);window.open("http://www.youtube.com/embed/"+me.params.youtubeVideo+"?vq=hd1080&autoplay=1&rel=0","_blank")}else{window.onresize=
function(){me.setPositioning()};me.launchExperience()}},addListeners:function(){var me=this,target=document.getElementById(me.params.target);target.addEventListener("click",function(){me.closeActiveOverlay();me.setupOverlay()},false)},addCloseEvent:function(iframe){var me=this,close=document.getElementById("apps_close"),container=document.getElementById("experience_container"),experience=me.params.experience.charAt(0).toUpperCase()+me.params.experience.slice(1);close.addEventListener("click",function(){me.overlayElement.setAttribute("class",
me.overlayName);dataLayer.push({"data-g-event":"Interactive Video","data-g-action":experience,"data-g-label":"Close Button","event":"autotrack-data-g"});if(iframe)me.container.parentNode.removeChild(me.container);else container.parentNode.removeChild(container);clearTimeout(timeoutID);window.onresize=function(){};me.closeActiveOverlay()},false)},closeActiveOverlay:function(){var me=this,overlayArray=document.getElementsByClassName("apps_overlay"),i=0,j=0,k=0,len=overlayArray.length,inputBoxes=document.getElementsByClassName("apps_input_box"),
lenInput=inputBoxes.length,overlayArrayMobile=document.getElementsByClassName("apps_overlay_mobile"),lenMobile=overlayArrayMobile.length;if(window[me.params.experience])window[me.params.experience].reset();if(activeApp)window[activeApp].reset();for(j;j<lenInput;j++)inputBoxes[i].parentNode.removeChild(inputBoxes[i]);for(i;i<len;i++)overlayArray[i].parentNode.removeChild(overlayArray[i]);for(k;k<lenMobile;k++)overlayArrayMobile[i].parentNode.removeChild(overlayArrayMobile[i]);clearTimeout(timeoutID)},
setPositioning:function(){var me=this,elem=document.getElementById(me.params.target);me.overlayElement=document.getElementById(me.overlayName+"-"+me.params.target);if(me.params.direction==="left")me.overlayElement.style.right=document.body.clientWidth-elem.offsetWidth-elem.offsetLeft+30+"px";else me.overlayElement.style.left=elem.offsetLeft+"px"},launchExperience:function(){var me=this,ptype=me.type,type=ptype&&ptype!=="iframe"?"ajax-":"iframe-",page=me.EXPERIENCE_HOST_LOCATION+"templates/"+type+
me.params.experience+".html",method="";setTimeout(function(){me.overlayElement.className="apps-exp-open "+me.overlayElement.className;setTimeout(function(){if(me.type)switch(me.type){case "iframe":method=me.iframeLoader(page);break;case "jquery":method=me.jqueryLoader(page);break;case "raw":method=me.rawLoader(page);break;default:method=me.iframeLoader(page)}else me.iframeLoader(page);me.overlayElement.className="apps-exp-loading "+me.overlayElement.className},900)},200)},appendLibraryScripts:function(position){var me=
this,scriptTag=document.createElement("script"),head=document.getElementsByTagName("head")[0],counter=me.LIBRARY_SCRIPTS.length;if(typeof scriptsAreLoaded!=="undefined"&&scriptsAreLoaded){setTimeout(function(){me.loadTranslations()},50);return}scriptTag.src=me.LIBRARY_SCRIPTS[position-1];scriptTag.addEventListener("load",function(){if(position!==counter)me.appendLibraryScripts(position+1);else{scriptsAreLoaded=true;me.loadTranslations()}},false);head.appendChild(scriptTag)},loadTranslations:function(){var me=
this,scriptTag=document.createElement("script"),head=document.getElementsByTagName("head")[0],JSON_object={},oRequest=new XMLHttpRequest,sURL=me.EXPERIENCE_HOST_LOCATION+"locale/"+me.params.experience+"."+me.locale+".json";oRequest.open("GET",sURL,true);oRequest.onreadystatechange=function(){if(oRequest.readyState==4&&oRequest.status==200){JSON_object=JSON.parse(oRequest.responseText);me.appendExperienceScript(JSON_object.translation)}};oRequest.send(null)},appendExperienceScript:function(translation){var me=
this,scriptTag=document.createElement("script"),head=document.getElementsByTagName("head")[0],path=me.EXPERIENCE_JS_LOCATION+"scripts/"+me.params.experience+".min.js";if(typeof window[me.params.experience]!=="undefined")setTimeout(function(){window[me.params.experience].init(me.params.outboundURL,translation,me.EXPERIENCE_HOST_LOCATION,me.params.ctaTitle,me.params.ctaSubTitle,me.params.ctaTagLine,me.params.ctaLinkText,me.params.ctaImage)},200);else{scriptTag.src=path;scriptTag.addEventListener("load",
function(){setTimeout(function(){window[me.params.experience].init(me.params.outboundURL,translation,me.EXPERIENCE_HOST_LOCATION,me.params.ctaTitle,me.params.ctaSubTitle,me.params.ctaTagLine,me.params.ctaLinkText,me.params.ctaImage)},200)},false);head.appendChild(scriptTag)}activeApp=me.params.experience},jqueryLoader:function(path){var me=this,page="";if(typeof $==="undefined"){if(me.JQUERY_FALLBACK==="iframe"){page="templates/iframe-"+me.params.experience+".html";me.iframeLoader(page)}else me.rawLoader(path);
return}$.ajax(path,{dataType:"html",async:true,success:function(data){me.appendLibraryScripts(1);$(me.container).html(data);me.addCloseEvent()}})},iframeLoader:function(path){var me=this;me.close=document.createElement("div");me.close.innerHTML="Close X";me.close.id="apps_close";me.container.appendChild(me.close);me.frame=document.createElement("iframe");me.frame.style.border="none";me.frame.style.height="100%";me.frame.style.margin="0";me.frame.style.overflow="hidden";me.frame.style.padding="0";
me.frame.style.width="100%";me.frame.src=path+"?outboundURL="+me.params.outboundURL;me.frame.onload=function(){me.addCloseEvent(true)};me.container.appendChild(me.frame)},rawLoader:function(path){var me=this,xhr=false;try{xhr=new XMLHttpRequest}catch(e){try{xhr=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{xhr=new ActiveXObject('Microsoft.XMLHTTP"')}catch(e){return false}}}xhr.onreadystatechange=function(){if(xhr.readyState===4)if(xhr.status===200){me.container.innerHTML=xhr.responseText;me.appendLibraryScripts(1);
me.addCloseEvent()}else if(xhr.status===404);};xhr.open("GET",path,true);xhr.setRequestHeader("Content-type","text/html");xhr.send()},launchVideo:function(){var me=this,tag=document.createElement("script"),firstScriptTag=document.getElementsByTagName("script")[0];tag.src="//www.youtube.com/iframe_api";firstScriptTag.parentNode.insertBefore(tag,firstScriptTag);me.youtubeStatus()},youtubeStatus:function(){var me=this,timerCount=1,timer=setInterval(function(){if(typeof youTubeLoaded!=="undefined"){clearInterval(timer);
me.setupVideo()}timerCount++},50)},setupVideo:function(){var me=this,width=me.container.offsetWidth,height=width*.61046511627907;me.player=new YT.Player(me.overlayName+"-"+me.params.target,{height:height,width:width,videoId:me.params.youtubeVideo||"bHjyeKbeGLI",events:{"onReady":me.onReady,"onStateChange":me.onStateChange,"onError":me.onError,"onApiChange":me.onApiChange}});window.onresize=function(){if(me.res)clearTimeout(me.res);var iframeElement=document.getElementById(me.overlayName+"-"+me.params.target),
ctaElement=document.getElementById(me.params.target),playTime=me.player.getCurrentTime();me.res=setTimeout(function(){if(me.params.direction==="left")iframeElement.style.right=document.body.clientWidth-ctaElement.offsetWidth-ctaElement.offsetLeft+30+"px";else iframeElement.style.left=ctaElement.offsetLeft+"px";iframeElement.style.top=ctaElement.offsetTop+"px";iframeElement.style.width=ctaElement.offsetWidth+"px";iframeElement.style.height=ctaElement.offsetHeight+"px";setTimeout(function(){if(me.player.getPlayerState()!=
5)me.player.seekTo(playTime)},1E3)},100)};me.player.containerID=me.overlayName+"-"+me.params.target},onReady:function(){},onStateChange:function(event){var me=appsExperience,experience=me.capitaliseFirstLetter(me.params.experience);if(event.data===0){event.target.destroy();var currOverlay=document.getElementById(event.target.containerID);currOverlay.parentNode.removeChild(currOverlay);dataLayer.push({"data-g-event":"Interactive Video","data-g-action":experience,"data-g-label":"Mobile: Video End",
"event":"autotrack-data-g"})}if(event.data===1)dataLayer.push({"data-g-event":"Interactive Video","data-g-action":experience,"data-g-label":"Mobile: Video Start","event":"autotrack-data-g"})},onError:function(){},onApiChange:function(){},capitaliseFirstLetter:function(string){return string.charAt(0).toUpperCase()+string.slice(1)}};